<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Sistema de Orçamento Técnico</title>
    <style>
        /* Estilos Gerais */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f9; /* Cinza claro de fundo */
            margin: 0;
            padding: 20px;
            color: #3a3f44; 
            line-height: 1.6;
            font-size: 15px;
        }

        .main-container {
            background-color: #ffffff;
            padding: 20px 30px 30px 30px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            width: 95%;
            max-width: 1100px; 
            margin: 20px auto;
        }

        h1 {
            color: #005a9c; 
            text-align: center;
            margin-bottom: 25px;
            font-size: 2em;
            font-weight: 600;
        }

        h2 {
            color: #007bff; 
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-top: 25px;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 500;
        }
        h3 {
            color: #0069d9; 
            margin-top: 20px;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 500;
        }
         h4 {
            color: #343a40;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1em;
            font-weight: 600;
        }

        /* Navegação por Abas */
        .tab-navigation {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 25px;
        }

        .tab-button {
            padding: 10px 18px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 1em;
            font-weight: 500;
            color: #495057;
            border-bottom: 3px solid transparent;
            margin-bottom: -1px; 
            margin-right: 8px;
            transition: color 0.2s ease, border-color 0.2s ease;
        }

        .tab-button:hover {
            color: #0056b3;
        }

        .tab-button.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab-content {
            display: none;
            padding-top: 10px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilos de Formulário */
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
            font-size: 0.9em;
        }

        select,
        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 9px 12px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 0.95em;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        select:focus,
        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 0.15rem rgba(0, 123, 255, 0.2);
        }
        
        textarea {
            min-height: 70px;
            resize: vertical;
        }
        
        .section-block { 
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 15px 20px;
            align-items: flex-start; 
        }
         .section-grid-tight { /* Para acionamentos */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); 
            gap: 10px 15px;
            align-items: flex-end; 
        }
        
        .field-group {
            display: flex;
            flex-direction: column;
        }
        
        .checkbox-group { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 15px 25px; 
            margin-top: 15px;
            align-items: start; 
        }

        .checkbox-item-container { 
            display: flex;
            flex-direction: column; 
            align-items: flex-start; 
        }
        
        .checkbox-label-wrapper { 
             display: flex;
             align-items: center;
             margin-bottom: 8px; 
        }


        .checkbox-item-container input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            accent-color: #007bff; 
            transform: scale(1.1); 
        }
        .checkbox-item-container .checkbox-label-wrapper label { 
            margin-bottom: 0;
            font-weight: normal;
            color: #333;
            font-size: 0.95em; 
        }
        
        .sub-field-wrapper { 
            display: none; 
            margin-top: 0px; 
            padding-left: 28px; 
        }
        .sub-field-wrapper label {
            font-size: 0.8em;
            color: #555;
            margin-bottom: 2px;
        }
        .sub-field-wrapper input[type="number"] {
            padding: 6px 8px;
            font-size: 0.9em;
            margin-bottom: 5px;
            max-width: 90px; 
            width: auto; 
            display: inline-block; 
        }
        
        /* Botões */
        button, .button { 
            background-color: #007bff; 
            color: white;
            padding: 9px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: background-color 0.2s, transform 0.1s;
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            text-decoration: none; 
        }
        button:active, .button:active {
            transform: translateY(1px);
        }

        button:hover, .button:hover {
            background-color: #0056b3; 
        }

        .button-final {
            background-color: #28a745; 
            padding: 12px 20px;
            font-size: 1.05em;
        }

        .button-final:hover {
            background-color: #1e7e34; 
        }
        
        /* Tabela de Acionamentos e Kits */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }

        th, td {
            border: 1px solid #dee2e6;
            padding: 9px 10px;
            text-align: left;
        }

        th {
            background-color: #007bff;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .delete-btn {
            background-color: #dc3545;
            padding: 5px 8px;
            font-size: 0.8em;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
         .edit-btn {
            background-color: #ffc107;
            color: #212529;
            padding: 5px 8px;
            font-size: 0.8em;
            margin-right: 5px;
        }
        .edit-btn:hover {
            background-color: #e0a800;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .section-grid, .section-grid-tight, .checkbox-group {
                grid-template-columns: 1fr; 
            }
            .main-container { 
                width: 95%;
                padding: 15px;
            }
            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }
            h2 {
                font-size: 1.4em;
                margin-bottom: 20px;
            }
            button, .button, .button-final {
                font-size: 0.9em;
                padding: 10px 15px;
            }
            .button-final {
                padding: 12px 20px;
            }
            .tab-navigation {
                font-size: 0.9em;
            }
            .tab-button {
                padding: 10px 15px;
            }
        }
        @media (max-width: 480px) {
            h1 { font-size: 1.6em; }
            h2 { font-size: 1.3em; }
            h3 { font-size: 1.1em; }
            .tab-button { padding: 8px 10px; font-size: 0.9em; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>Sistema de Orçamento Técnico</h1>

        <div class="tab-navigation">
            <button class="tab-button active" onclick="openTab(event, 'configProjeto')">Configurar Projeto</button>
            <button class="tab-button" onclick="openTab(event, 'cadastros')">Cadastros</button>
        </div>

        <!-- Aba 1: Configuração Detalhada do Projeto -->
        <div id="configProjeto" class="tab-content active">
            <h2>Configuração Detalhada do Projeto</h2>

            <section id="config-automacao-principal" class="section-block">
                <h3>1.1. Sistema de Automação Principal (CLP)</h3>
                <div class="section-grid">
                    <div class="field-group">
                        <label for="proj-clp-marca">Marca do CLP:</label>
                        <select id="proj-clp-marca">
                            <option value="">Selecione</option>
                            <option value="Siemens">Siemens</option>
                            <option value="Rockwell">Rockwell</option>
                            <option value="Schneider">Schneider Electric</option>
                            <option value="Outra">Outra</option>
                        </select>
                    </div>
                    <div class="field-group" id="proj-clp-familia-wrapper" style="display: none;">
                        <label for="proj-clp-familia">Família/Modelo CLP:</label>
                        <select id="proj-clp-familia"></select>
                    </div>
                </div>
                <div class="checkbox-group" style="margin-top: 20px;">
                    <div class="checkbox-item-container">
                        <div class="checkbox-label-wrapper">
                            <input type="checkbox" id="proj-clp-safety">
                            <label for="proj-clp-safety">CLP com Safety?</label>
                        </div>
                        <div id="proj-clp-safety-di-wrapper" class="sub-field-wrapper">
                            <label for="proj-clp-safety-di">DI Safety:</label>
                            <input type="number" id="proj-clp-safety-di" value="0" min="0">
                        </div>
                         <div id="proj-clp-safety-do-wrapper" class="sub-field-wrapper">
                            <label for="proj-clp-safety-do">DO Safety:</label>
                            <input type="number" id="proj-clp-safety-do" value="0" min="0">
                        </div>
                    </div>
                     <div class="checkbox-item-container">
                        <div class="checkbox-label-wrapper">
                            <input type="checkbox" id="proj-controle-eixo">
                            <label for="proj-controle-eixo">Controle de Eixo?</label>
                        </div>
                        <div id="proj-num-eixos-wrapper" class="sub-field-wrapper">
                            <label for="proj-num-eixos">Nº de Eixos:</label>
                            <input type="number" id="proj-num-eixos" value="0" min="0">
                        </div>
                    </div>
                    <div class="checkbox-item-container">
                        <div class="checkbox-label-wrapper">
                            <input type="checkbox" id="proj-entradas-rapidas">
                            <label for="proj-entradas-rapidas">Entradas Rápidas (HSI)?</label>
                        </div>
                         <div id="proj-num-entradas-rapidas-wrapper" class="sub-field-wrapper">
                            <label for="proj-num-entradas-rapidas">Nº de HSI:</label>
                            <input type="number" id="proj-num-entradas-rapidas" value="0" min="0">
                        </div>
                    </div>
                    <div class="checkbox-item-container">
                        <div class="checkbox-label-wrapper">
                            <input type="checkbox" id="proj-saidas-rapidas">
                            <label for="proj-saidas-rapidas">Saídas Rápidas (PTO/PWM)?</label>
                        </div>
                        <div id="num-saidas-rapidas-wrapper" class="sub-field-wrapper">
                            <label for="proj-num-saidas-rapidas">Nº de PTO/PWM:</label>
                            <input type="number" id="proj-num-saidas-rapidas" value="0" min="0">
                        </div>
                    </div>
                </div>
            </section>

            <section id="config-ihm" class="section-block">
                <h3>1.2. Sistema de IHM</h3>
                 <div class="section-grid">
                    <div class="field-group">
                        <label for="proj-ihm-marca">Marca da IHM:</label>
                        <select id="proj-ihm-marca">
                            <option value="">Selecione</option>
                            <option value="Siemens">Siemens</option>
                            <option value="Rockwell">Rockwell</option>
                            <option value="WEG">WEG</option>
                            <option value="Outra">Outra</option>
                        </select>
                    </div>
                    <div class="field-group" id="proj-ihm-familia-wrapper" style="display: none;">
                        <label for="proj-ihm-familia">Família/Modelo IHM:</label>
                        <select id="proj-ihm-familia"></select>
                    </div>
                </div>
            </section>


            <section id="config-acionamentos" class="section-block">
                <h3>1.3. Cadastro de Acionamentos do Projeto</h3>
                <div class="section-grid-tight" style="align-items: flex-end;">
                    <div class="field-group">
                        <label for="ac-marca-proj">Marca:</label>
                        <select id="ac-marca-proj">
                            <option value="Siemens">Siemens</option><option value="ABB">ABB</option><option value="Rockwell">Rockwell</option><option value="WEG">WEG</option><option value="Outra">Outra</option>
                        </select>
                    </div>
                    <div class="field-group">
                        <label for="ac-potencia-proj">Potência (CV):</label>
                        <input type="number" id="ac-potencia-proj" min="0.25" step="0.25" value="1">
                    </div>
                    <div class="field-group">
                        <label for="ac-tensao-proj">Tensão:</label>
                        <select id="ac-tensao-proj"><option value="220V Trifásico">220V Trifásico</option><option value="380V Trifásico">380V Trifásico</option><option value="440V Trifásico">440V Trifásico</option><option value="Outra">Outra</option></select>
                    </div>
                    <div class="field-group">
                        <label for="ac-tipo-partida-proj">Tipo de Partida:</label>
                        <select id="ac-tipo-partida-proj"><option value="Direta">Direta</option><option value="Estrela-Triângulo">Estrela-Triângulo</option><option value="Soft-Starter">Soft-Starter</option><option value="Inversor">Inversor</option></select>
                    </div>
                     <div class="field-group">
                        <label for="ac-protecao-proj">Proteção:</label>
                        <select id="ac-protecao-proj"><option value="Disjuntor Motor">Disjuntor Motor (TOP)</option><option value="Fusível + Contator + Relé Térmico">Fusível + Contator + Relé Térmico</option><option value="Outra">Outra</option></select>
                    </div>
                    <div class="field-group">
                        <button id="btn-add-acionamento-lista">Adicionar à Lista</button>
                    </div>
                </div>
                <table id="tabela-acionamentos-projeto">
                    <thead><tr><th>Marca</th><th>Potência</th><th>Tensão</th><th>Partida</th><th>Proteção</th><th>Ação</th></tr></thead>
                    <tbody></tbody>
                </table>
            </section>
            <button class="button-final" onclick="alert('Lógica de geração de itens não implementada ainda.')">Gerar Itens para Orçamento com Base na Configuração do Projeto</button>
        </div>

        <!-- Aba 2: Cadastros -->
        <div id="cadastros" class="tab-content">
            <h2>Cadastros Gerais</h2>
            <section id="cadastro-kits-tecnicos" class="section-block">
                <h3>Cadastro de Kits Técnicos</h3>
                <div class="section-grid">
                    <div class="field-group">
                        <label for="kit-nome">Nome do Kit:</label>
                        <input type="text" id="kit-nome" placeholder="Ex: Kit CLP Básico Siemens S7-1200">
                    </div>
                    <div class="field-group">
                        <label for="kit-tipo">Tipo do Kit:</label>
                        <select id="kit-tipo">
                            <option value="CLP">CLP</option>
                            <option value="IHM">IHM</option>
                            <option value="Acionamento">Acionamento (Motor+Partida)</option>
                            <option value="Transmissor">Transmissor</option>
                            <option value="Sensor">Sensor</option>
                            <option value="Painel">Painel Elétrico</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                </div>
                <div class="field-group">
                    <label for="kit-descricao">Descrição Detalhada do Kit:</label>
                    <textarea id="kit-descricao" placeholder="Componentes principais, características..."></textarea>
                </div>

                <h4>Itens do Kit:</h4>
                <div class="section-grid" style="align-items: flex-end;">
                    <div class="field-group">
                        <label for="kit-item-produto">Produto (do banco simulado):</label>
                        <select id="kit-item-produto"> 
                            <!-- Populado por JS a partir do bancoDeProdutos -->
                        </select>
                    </div>
                    <div class="field-group">
                        <label for="kit-item-qtd">Quantidade:</label>
                        <input type="number" id="kit-item-qtd" value="1" min="1">
                    </div>
                    <div class="field-group">
                        <button id="btn-add-item-kit">Adicionar Item ao Kit</button>
                    </div>
                </div>
                <table id="tabela-itens-kit-atual">
                    <thead><tr><th>Produto</th><th>Qtd</th><th>Ação</th></tr></thead>
                    <tbody></tbody>
                </table>
                <button onclick="salvarKitTecnico()" style="margin-top: 15px; background-color: #17a2b8;">Salvar Kit Técnico</button>
            </section>

            <section id="kits-salvos" class="section-block" style="margin-top: 30px;">
                <h3>Kits Técnicos Salvos</h3>
                <div class="overflow-x-auto">
                    <table id="tabela-kits-salvos">
                        <thead><tr><th>Nome</th><th>Tipo</th><th>Descrição</th><th>Ações</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <script>
        // --- DADOS SIMULADOS (Globais) ---
        const familiasPLC = {
            Siemens: ["S7-1200", "S7-1500", "S7-300", "LOGO!"],
            Rockwell: ["CompactLogix", "ControlLogix", "MicroLogix"],
            Schneider: ["Modicon M221", "Modicon M241", "Modicon M251"],
            Outra: ["Genérico/Outro"]
        };
        const familiasIHM = {
            Siemens: ["Basic Panel (KTP)", "Comfort Panel (TP)", "Unified Comfort Panel"],
            Rockwell: ["PanelView 5000", "PanelView 5310", "PanelView Plus 7"],
            WEG: ["OptiView", "MT Series"],
            Outra: ["Genérica/Outra"]
        };
        const bancoDeProdutos = [ 
            { id: "prod1", nome: "CLP Siemens S7-1200 CPU 1214C", tipo: "CLP" },
            { id: "prod2", nome: "IHM Siemens KTP700 Basic", tipo: "IHM" },
            { id: "prod3", nome: "Fonte Siemens 24V 5A", tipo: "Componente" },
            { id: "prod4", nome: "Contator WEG CWB9", tipo: "Componente" },
            { id: "prod5", nome: "Disjuntor Motor Siemens 3RV", tipo: "Componente" },
            { id: "prod6", nome: "Inversor Siemens G120C 1.5kW", tipo: "Drive" },
        ];
        let acionamentosDoProjeto = [];
        let kitsSalvos = [];
        let itensKitAtual = [];

        // --- FUNÇÕES AUXILIARES DE UI (Definidas Primeiro) ---
        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            const currentTabContent = document.getElementById(tabName);
            if (currentTabContent) {
                currentTabContent.style.display = "block";
                currentTabContent.classList.add("active");
            }
            let clickedButton = evt ? evt.currentTarget : null;
            if (!clickedButton && tabName) {
                 clickedButton = Array.from(tablinks).find(btn => btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(`openTab(event, '${tabName}')`));
            }
            if(clickedButton) clickedButton.classList.add("active");
        }

        function popularDropdown(selectId, opcoes, placeholder = "Selecione") {
            const select = document.getElementById(selectId);
            if (!select) {
                // console.error("Dropdown com ID '" + selectId + "' não encontrado."); // Comentado para reduzir logs
                return;
            }
            select.innerHTML = `<option value="">${placeholder}</option>`;
            opcoes.forEach(opcao => {
                const optionEl = document.createElement('option');
                optionEl.value = opcao;
                optionEl.textContent = opcao;
                select.appendChild(optionEl);
            });
        }
        
        function toggleConditionalFields() { 
            toggleNumericInput('proj-clp-safety', 'proj-clp-safety-di-wrapper', 'proj-clp-safety-di');
            toggleNumericInput('proj-clp-safety', 'proj-clp-safety-do-wrapper', 'proj-clp-safety-do');
            toggleNumericInput('proj-controle-eixo', 'proj-num-eixos-wrapper', 'proj-num-eixos');
            toggleNumericInput('proj-entradas-rapidas', 'proj-num-entradas-rapidas-wrapper', 'proj-num-entradas-rapidas');
            toggleNumericInput('proj-saidas-rapidas', 'num-saidas-rapidas-wrapper', 'proj-num-saidas-rapidas'); 
        }

        function toggleNumericInput(checkboxId, wrapperId, inputId) {
            const checkbox = document.getElementById(checkboxId);
            const wrapper = document.getElementById(wrapperId);
            const input = document.getElementById(inputId);
            if (checkbox && wrapper && input) { 
                wrapper.style.display = checkbox.checked ? 'block' : 'none';
                if (!checkbox.checked) {
                    input.value = '0';
                }
            }
        }

        // --- ABA: CONFIGURAR PROJETO ---
        function setupConfigProjetoListeners() {
            const clpMarcaSelect = document.getElementById('proj-clp-marca');
            if (clpMarcaSelect) {
                clpMarcaSelect.addEventListener('change', function() {
                    const marca = this.value;
                    const familiaSelect = document.getElementById('proj-clp-familia');
                    const familiaWrapper = document.getElementById('proj-clp-familia-wrapper');
                    if (!familiaSelect || !familiaWrapper) return;
                    familiaSelect.innerHTML = '<option value="">Selecione a Família</option>';
                    if (marca && familiasPLC[marca]) {
                        familiasPLC[marca].forEach(familia => {
                            const option = document.createElement('option');
                            option.value = familia;
                            option.textContent = familia;
                            familiaSelect.appendChild(option);
                        });
                        familiaWrapper.style.display = 'block';
                    } else {
                        familiaWrapper.style.display = 'none';
                    }
                });
            }

            const ihmMarcaSelect = document.getElementById('proj-ihm-marca');
            if (ihmMarcaSelect) {
                ihmMarcaSelect.addEventListener('change', function() {
                    const marca = this.value;
                    const familiaSelect = document.getElementById('proj-ihm-familia');
                    const familiaWrapper = document.getElementById('proj-ihm-familia-wrapper');
                    if (!familiaSelect || !familiaWrapper) return;
                    familiaSelect.innerHTML = '<option value="">Selecione a Família</option>';
                    if (marca && familiasIHM[marca]) {
                        familiasIHM[marca].forEach(familia => {
                            const option = document.createElement('option');
                            option.value = familia;
                            option.textContent = familia;
                            familiaSelect.appendChild(option);
                        });
                        familiaWrapper.style.display = 'block';
                    } else {
                        familiaWrapper.style.display = 'none';
                    }
                });
            }
            
            ['proj-clp-safety', 'proj-controle-eixo', 'proj-entradas-rapidas', 'proj-saidas-rapidas'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('change', toggleConditionalFields);
            });


            const btnAddAcionamentoLista = document.getElementById('btn-add-acionamento-lista');
            if(btnAddAcionamentoLista) btnAddAcionamentoLista.addEventListener('click', addAcionamentoToProjectList);
        }
        
        function addAcionamentoToProjectList() {
            const marcaEl = document.getElementById('ac-marca-proj');
            const potenciaEl = document.getElementById('ac-potencia-proj');
            const tensaoEl = document.getElementById('ac-tensao-proj');
            const tipoPartidaEl = document.getElementById('ac-tipo-partida-proj');
            const protecaoEl = document.getElementById('ac-protecao-proj');

            if (!marcaEl || !potenciaEl || !tensaoEl || !tipoPartidaEl || !protecaoEl) {
                console.error("Elementos do formulário de acionamento não encontrados.");
                return;
            }

            const marca = marcaEl.value;
            const potencia = potenciaEl.value;
            const tensao = tensaoEl.value;
            const tipoPartida = tipoPartidaEl.value;
            const protecao = protecaoEl.value;


            if (!potencia) {
                alert("Por favor, insira a potência do motor.");
                return;
            }
            const acionamento = { id: Date.now(), marca, potencia, tensao, tipoPartida, protecao };
            acionamentosDoProjeto.push(acionamento);
            renderAcionamentosProjeto();
        }

        function renderAcionamentosProjeto() {
            const tbody = document.getElementById('tabela-acionamentos-projeto')?.getElementsByTagName('tbody')[0];
            if (!tbody) return;
            tbody.innerHTML = ""; 
            acionamentosDoProjeto.forEach(ac => {
                const row = tbody.insertRow();
                row.insertCell().textContent = ac.marca;
                row.insertCell().textContent = ac.potencia + " CV";
                row.insertCell().textContent = ac.tensao;
                row.insertCell().textContent = ac.tipoPartida;
                row.insertCell().textContent = ac.protecao;
                const cellAcao = row.insertCell();
                const btnExcluir = document.createElement('button');
                btnExcluir.textContent = "Excluir";
                btnExcluir.className = "delete-btn";
                btnExcluir.onclick = function() { removerAcionamentoProjeto(ac.id); };
                cellAcao.appendChild(btnExcluir);
            });
        }
        function removerAcionamentoProjeto(id) {
            acionamentosDoProjeto = acionamentosDoProjeto.filter(ac => ac.id !== id);
            renderAcionamentosProjeto();
        }
        
        // --- ABA: CADASTROS ---
        function popularProdutosParaKit() {
            const select = document.getElementById('kit-item-produto');
            if(!select) return;
            select.innerHTML = '<option value="">Selecione um produto</option>';
            bancoDeProdutos.forEach(prod => {
                const option = document.createElement('option');
                option.value = prod.id;
                option.textContent = `${prod.nome} (${prod.tipo})`;
                select.appendChild(option);
            });
        }

        function adicionarItemAoKitAtual() {
            const produtoSelect = document.getElementById('kit-item-produto');
            const produtoId = produtoSelect.value;
            const qtd = parseInt(document.getElementById('kit-item-qtd').value, 10);

            if (!produtoId || isNaN(qtd) || qtd < 1) {
                alert("Selecione um produto e informe uma quantidade válida.");
                return;
            }
            const produtoExistente = itensKitAtual.find(item => item.produtoId === produtoId);
            if (produtoExistente) {
                produtoExistente.qtd += qtd;
            } else {
                itensKitAtual.push({ produtoId, qtd });
            }
            renderItensKitAtual();
            document.getElementById('kit-item-qtd').value = 1; 
            produtoSelect.value = ""; 
        }

        function renderItensKitAtual() {
            const tbody = document.getElementById('tabela-itens-kit-atual')?.getElementsByTagName('tbody')[0];
            if(!tbody) return;
            tbody.innerHTML = "";
            itensKitAtual.forEach((item, index) => {
                const produtoInfo = bancoDeProdutos.find(p => p.id === item.produtoId);
                const row = tbody.insertRow();
                row.insertCell().textContent = produtoInfo ? produtoInfo.nome : 'Produto Desconhecido';
                row.insertCell().textContent = item.qtd;
                const cellAcao = row.insertCell();
                const btnExcluir = document.createElement('button');
                btnExcluir.textContent = "Remover";
                btnExcluir.className = "delete-btn";
                btnExcluir.onclick = function() { removerItemDoKitAtual(index); };
                cellAcao.appendChild(btnExcluir);
            });
        }
        function removerItemDoKitAtual(index) {
            itensKitAtual.splice(index, 1);
            renderItensKitAtual();
        }

        function salvarKitTecnico() {
            const nome = document.getElementById('kit-nome').value.trim();
            const tipo = document.getElementById('kit-tipo').value;
            const descricao = document.getElementById('kit-descricao').value.trim();

            if (!nome || !tipo) {
                alert("Nome e Tipo do Kit são obrigatórios.");
                return;
            }
            
            const novoKit = {
                id: 'kit' + Date.now(),
                nome, tipo, descricao,
                itens: [...itensKitAtual] 
            };
            kitsSalvos.push(novoKit);
            alert(`Kit "${nome}" salvo com sucesso!`);
            
            document.getElementById('kit-nome').value = '';
            document.getElementById('kit-tipo').value = 'CLP';
            document.getElementById('kit-descricao').value = '';
            itensKitAtual = [];
            renderItensKitAtual();
            renderKitsSalvos();
        }

        function renderKitsSalvos() {
            const tbody = document.getElementById('tabela-kits-salvos')?.getElementsByTagName('tbody')[0];
             if(!tbody) return;
            tbody.innerHTML = "";
            kitsSalvos.forEach(kit => {
                const row = tbody.insertRow();
                row.insertCell().textContent = kit.nome;
                row.insertCell().textContent = kit.tipo;
                row.insertCell().textContent = kit.descricao.substring(0, 50) + (kit.descricao.length > 50 ? '...' : '');
                
                const cellAcao = row.insertCell();
                const btnUsar = document.createElement('button');
                btnUsar.textContent = "Usar no Projeto";
                btnUsar.className = "button";
                btnUsar.style.marginRight = "5px";
                btnUsar.onclick = function() { usarKitNoProjeto(kit.id); };
                cellAcao.appendChild(btnUsar);
                
                const btnEditar = document.createElement('button');
                btnEditar.textContent = "Editar";
                btnEditar.className = "edit-btn";
                btnEditar.onclick = function() { alert(`Funcionalidade "Editar Kit ${kit.nome}" não implementada.`); };
                cellAcao.appendChild(btnEditar);
            });
        }

        function usarKitNoProjeto(kitId) {
            const kit = kitsSalvos.find(k => k.id === kitId);
            if (!kit) return;

            alert(`Simulando uso do kit "${kit.nome}"...\nOs campos na aba "Configurar Projeto" seriam preenchidos com os dados deste kit.`);
            if (kit.tipo === "CLP") {
                const marcaClpEl = document.getElementById('proj-clp-marca');
                // Ex: if(kit.marca && marcaClpEl) marcaClpEl.value = kit.marca; 
                // if(marcaClpEl) marcaClpEl.dispatchEvent(new Event('change')); 
                // setTimeout(() => { 
                //      const familiaClpEl = document.getElementById('proj-clp-familia');
                //      if(familiaClpEl && kit.familia) familiaClpEl.value = kit.familia; 
                // }, 100);
            }
            const configButton = document.querySelector('.tab-button[data-tab="configProjeto"]');
            if (configButton) openTab({currentTarget: configButton}, 'configProjeto'); 
        }

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            try {
                setupTabs(); 
                const initialTabButton = document.querySelector('.tab-button[data-tab="configProjeto"]');
                if (initialTabButton) {
                     openTab({currentTarget: initialTabButton }, 'configProjeto');
                } else if (document.querySelectorAll('.tab-button').length > 0) {
                    const firstButton = document.querySelectorAll('.tab-button')[0];
                    if(firstButton) openTab({currentTarget: firstButton }, firstButton.dataset.tab);
                }
                
                setupConfigProjetoListeners(); 
                toggleConditionalFields(); 

                const btnAddItemKitEl = document.getElementById('btn-add-item-kit');
                if (btnAddItemKitEl) btnAddItemKitEl.addEventListener('click', adicionarItemAoKitAtual);
                
                popularProdutosParaKit();
                renderKitsSalvos(); 

            } catch (error) {
                console.error("Erro durante a inicialização:", error);
                const appDiv = document.getElementById('app');
                if (appDiv) {
                    appDiv.innerHTML = `<div style="padding: 20px; background-color: #ffdddd; border: 1px solid #ffcccc; color: #D8000C; border-radius: 5px;">
                                            <strong>Erro Crítico!</strong> A aplicação não pôde ser carregada corretamente. Verifique o console do navegador (F12) para mais detalhes técnicos.<br>
                                            Detalhe: ${error.message}
                                        </div>`;
                }
            }
        });

    </script>
</body>
</html>
